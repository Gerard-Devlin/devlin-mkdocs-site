[TOC]

# 9

## 9.1.1

### å–åœ°å€è¿ç®—

#### è¿ç®—ç¬¦`&`

è·å¾—å˜é‡çš„åœ°å€ï¼Œå®ƒçš„æ“ä½œå¿…é¡»æ˜¯åœ°å€

!!! BUG
    >
    > åœ°å€å¤§å°æ˜¯å¦ä¸`int`ç›¸åŒå–å†³äºç¼–è¯‘å™¨
    >
    > `&(aÂ±b)`ä¸èƒ½å–åœ°å€
    >
    > ```c
    > printf("%p",&i);//&i è¡¨ç¤ºæ‰“å°å˜é‡åœ°å€
    > ```

## 9.1.2

### æŒ‡é’ˆ

å°±æ˜¯==ä¿å­˜åœ°å€==çš„å˜é‡

```c
int *p = &i;
int *p,q;//pæ˜¯æŒ‡é’ˆï¼Œqæ˜¯intâ†’ *pæ˜¯ä¸€ç§ç±»å‹ï¼Œæ²¡æœ‰int*è¿™ç§ç±»å‹
```

### è®¿é—®åœ°å€ä¸Šçš„å˜é‡`*`

```mermaid
flowchart LR
    subgraph Memory
        A[å˜é‡ x\nå€¼: 10\nåœ°å€: 0x7ffd5]
    end
    subgraph "å–åœ°å€æ“ä½œ &x"
        B((å–åœ°å€è¿ç®—ç¬¦ &))
    end
    subgraph "æŒ‡é’ˆ p"
        C[æŒ‡é’ˆ p\nå­˜å‚¨çš„åœ°å€: 0x7ffd5]
    end
    A -->|åœ°å€| B
    B -->|èµ‹å€¼| C
    C -.->|æŒ‡å‘| A
```

```c
int main(void) {
    int *p;
    int a=8;
    p=&a;
    printf("%d\n",*p);//â†’8				 ï¼š*pæŒ‡å‘å€¼
    printf("%p\n",p);//â†’0000005ff6bffaa4   ï¼špè¡¨ç¤ºåœ°å€
    return 0;
}
```

```c
void f(int *p);
void g(int k);
int main(void) {
    int i =6;
    printf("&i=%p\n",&i);
    f(&i);
    g(i);
    return 0;
}

void f(int *p) {
    printf("p=%p\n",p);
    printf("*p=%p\n",*p);
    *p=26;//é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼
}

void g(int k) {
    printf("k=%d\n",k);
}
----------------------------->
&i=000000050cfffd7c
p=000000050cfffd7c
*p=0000000000000006
k=26
```

## 9.1.3

### æŒ‡é’ˆçš„ä½¿ç”¨

#### 1ã€ä¸¤ä¸ªå˜é‡åšäº¤æ¢ï¼ˆä¹‹å‰å˜é‡éƒ½æœ‰é™å®šçš„ä½œç”¨åŸŸï¼‰

```c
void swap(int *pa, int *pb);

int main(void) {
    int a=5;
    int b=6;
    swap (&a,&b);
    printf("a=%d, b=%d\n",a,b);
    return 0;
}
void swap(int *pa, int *pb) {
    int t =*pa;
    *pa=*pb;
    *pb=t;
}
```

#### 2ã€å‡½æ•°è¿”å›å¤šä¸ªå€¼ï¼ŒæŸäº›å€¼è¦æŒ‡é’ˆå¸¦å›ï¼ˆ==returnåªèƒ½è¿”å›ä¸€ä¸ªå€¼==ï¼‰

```c
void minmax(int a[],int len,int *max,int *min);

int main (void) {
    int a[]={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
    int min,max;
    minmax(a,sizeof(a)/sizeof(a[0]),&max,&min);
    printf("min = %d,max = %d\n",min,max);
    return 0;
}

void minmax(int a[],int len,int *max,int *min) {
    int i;
    *min =*max =a[0];
    for (i=1;i<len;i++) {
        if (a[i]<*min) {
            *min = a[i];
        }
        if (a[i]>*max) {
            *max = a[i];
        }
    }

}
```

3ã€å‡½æ•°è¿”å›è¿ç®—çš„çŠ¶æ€ï¼Œç»“æœé€šè¿‡æŒ‡é’ˆè¿”å›

â€‹	å¸¸ç”¨å¥—è·¯ï¼šè®©å‡½æ•°è¿”å›iç‰¹æ®Šçš„ä¸å±äºæœ‰æ•ˆèŒƒå›´çš„å€¼è¡¨ç¤ºå‡ºé”™â†’-1/0

```c
int divide(int a, int b,int *result);

int main() {
    int a=5;
    int b=2;
    int c;
    if(divide(a,b,&c)) {
        printf("%d/%d=%d\n",a,b,c);
    }
    return 0;
}
int divide(int a, int b,int *result) {
    int ret =1;
    if (b==0) ret=0;
    else {
        *result=a/b;
    }
    return ret;
}
```

!!! bug
    >
    > **æŒ‡é’ˆæ²¡æœ‰æŒ‡å‘å˜é‡åœ°å€ï¼Œå°±å¼€å§‹ä½¿ç”¨æŒ‡é’ˆ**

## 9.1.4

### æŒ‡é’ˆå’Œæ•°ç»„

#### ä¼ å…¥æ•°ç»„æˆäº†ä»€ä¹ˆï¼Ÿ

```c
void minmax(int a[],int len,int *max,int *min);

int main (void) {
    int a[]={1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
    int min,max;
    printf("main sizeof(a)=%llu\n",sizeof(a));//â†’60
    printf("main a=%p\n",&a);//â†’00000077c0fffe00
    minmax(a,sizeof(a)/sizeof(a[0]),&max,&min);
    printf("min = %d,max = %d\n",min,max);
    return 0;
}
		//ğŸ‘‡a[]å’Œ*aç­‰ä»·
void minmax(int a[],int len,int *max,int *min) {
    int i;
    printf("minmax sizeof(a)=%llu\n",sizeof(a));//â†’8
    printf("minmax a=%p\n",&a);//â†’00000077c0fffe00
    *min =*max =a[0];
    for (i=1;i<len;i++) {
        if (a[i]<*min) {
            *min = a[i];
        }
        if (a[i]>*max) {
            *max = a[i];
        }
    }
}
```

!!! note
    >
    > - å‡½æ•°å‚æ•°è¡¨ä¸­çš„æ•°ç»„å…¶å®æ˜¯æŒ‡é’ˆ
    >   - `sizeof(a) == sizeof(int*)`

### æ•°ç»„å˜é‡æ˜¯ç‰¹æ®Šçš„æŒ‡é’ˆ

æ•°ç»„æœ¬èº«è¡¨è¾¾åœ°å€

```c
int a[10];int *p=a;//æ— éœ€ç”¨&å–åœ°å€
```

```c
a == &a[0];		  //æ•°ç»„å•å…ƒè¡¨ç¤ºå˜é‡ï¼Œéœ€è¦&å–åœ°å€
```

`*`è¿ç®—ç¬¦å¯ä»¥å¯¹æŒ‡é’ˆåšä¹Ÿå¯ä»¥å¯¹æ•°ç»„åš

```c
 *a =25ï¼›
```

æ•°ç»„å˜é‡æ˜¯`const`æŒ‡é’ˆï¼Œä¸èƒ½è¢«å¤åˆ¶

```c
int b[]->int *const b
```

## 9.1.5

### æŒ‡é’ˆä¸å˜é‡

```c
int i;
const int* p1 = &i;
int const *p2 = &i;
int *const p3 = &i;
```

!!! note
    >
    > `const`åœ¨`*`å‰ï¼šæ‰€æŒ‡çš„ä¸œè¥¿ä¸èƒ½è¢«ä¿®æ”¹
    >
    > `const`åœ¨`*`åï¼šæŒ‡é’ˆä¸èƒ½è¢«ä¿®æ”¹

### `const`æ•°ç»„

```c
const int a[]={1,2,3,4,5,6,};
//ä¸å¯ä¿®æ”¹ï¼Œå¿…é¡»åˆå§‹åŒ–
```

## 9.2.1

### æŒ‡é’ˆè¿ç®—

```c
int main(void) {
    //char
    char ac[]={0,1,2,3,4,5,6,};
    char *p =ac;
    printf("p= %p\n",p);
    printf("p+1= %p\n",p+1);

	//int
    int ai[]={0,1,2,3,4,5,6,};
    int *q =ai;
    printf("q= %p\n",q);
    printf("q+1= %p\n",q+1);
}
------------------------>
p= 0000006976dffbb9
p+1= 0000006976dffbba//+1
q= 0000006976dffb90
q+1= 0000006976dffb94//+4
```

```mermaid
block-beta
	columns 3
  block:group1:3
  %% columns auto (default)
  1 2 3 
 end
 
  block:group2:3
    %% columns auto (default)
     54 55 56 57 58 59 5a 5b 5c 5d 5e 5f
  end

    
```

- `*p    ->a[0]`
- `*(p+1)->a[1]`

å¹¶ä¸æ˜¯åœ¨åœ°å€ä¸Š+1ï¼Œå¦åˆ™æ²¡æœ‰æ„ä¹‰

```c
int main(void) {
    char ac[]={0,1,2,3,4,5,6,};
    char *p =ac;//-->ç­‰ä»·*p=&ac[0]
    char *p1=&ac[5];
    printf("p= %p\n",p);//p= 0000008992bff7c6
    printf("p1= %p\n",p1);//p1= 0000008992bff7cb
    printf("p1-p= %p\n",p1-p);//p1-p= 5

    //0000008992bff7c6[HEX] - 0000008992bff7cb[HEX]= 5[DEC]â†’ sizeof(char)*5
    
    int ai[]={0,1,2,3,4,5,6,};
    int *q =ai;
    int *q1=&ai[6];
    printf("q= %p\n",q);//q= 00000039e4bffaf0
    printf("q1= %p\n",q1);//q1= 00000039e4bffb08
    printf("q1-q= %p\n",q1-q);//q1-q= 6
   
    //00000039e4bffb08[HEX] - 00000039e4bffaf0[HEX]= 24[DEC]â†’ sizeof(int)*6
}
```

### `*p++`

```c
int main(void) {
    char ac[]={0,1,2,3,4,5,6,7,8,9,-1,};
    char *p =&ac[0];
//ç¬¬ä¸€ç§éå†
    for(int i=0;i<sizeof(ac)/sizeof(ac[0]);i++) {
        printf("%d\n",ac[i]);
    }
//ç¬¬äºŒç§éå†
    while(*p!=-1) {
        printf("%d\n",*p++);
    }
}
```

### `0`åœ°å€

```mermaid
stateDiagram
0åœ°å€å¯ä»¥ç”¨æ¥è¡¨ç¤ºç‰¹æ®Šäº‹æƒ…-->è¿”å›æŒ‡é’ˆæ— æ•ˆ
0åœ°å€å¯ä»¥ç”¨æ¥è¡¨ç¤ºç‰¹æ®Šäº‹æƒ…-->æŒ‡é’ˆæ²¡æœ‰è¢«åˆå§‹åŒ–
```

**æŒ‡é’ˆä¸åº”è¯¥å…·æœ‰0å€¼**

`NULL`æ˜¯ä¸€ä¸ªé¢„å®šå®šä¹‰çš„ç¬¦å·ï¼Œè¡¨ç¤º`0`åœ°å€

- æœ‰çš„ç¼–è¯‘å™¨ä¸æ„¿æ„ä½ ç”¨`0`æ¥è¡¨ç¤º`0`åœ°å€

### æŒ‡é’ˆç±»å‹

æŒ‡å‘ä¸åŒç±»å‹çš„æŒ‡é’ˆä¸èƒ½äº’ç›¸ç›´æ¥èµ‹å€¼â†ä¸ºé¿å…ç”¨é”™æŒ‡é’ˆ

#### æŒ‡é’ˆç±»å‹è½¬æ¢

`void*` è¡¨ç¤ºä¸çŸ¥é“æŒ‡å‘ä»€ä¹ˆä¸œè¥¿çš„æŒ‡é’ˆ

```c
int *p =&i;
void *q=(void*)p;
//é€šè¿‡pçœ‹iæ˜¯intï¼›é€šè¿‡qçœ‹iæ˜¯void
```

```mermaid
stateDiagram
p-->i :int
q-->i :void
```

## 9.2.2

### åŠ¨æ€å†…å­˜åˆ†é…

C99èƒ½ç”¨å˜é‡åšæ•°ç»„å®šä¹‰çš„å¤§å°ï¼Œä¹‹å‰å‘¢ï¼Ÿ

```c
int *a=(*int)malloc(*n*sizeof(int));
//(int*) å°† void* ç±»å‹çš„æŒ‡é’ˆå¼ºåˆ¶è½¬æ¢ä¸º int* ç±»å‹çš„æŒ‡é’ˆï¼Œä½¿å…¶å¯ä»¥æŒ‡å‘ä¸€ä¸ªæ•´æ•°æ•°ç»„
```

```c
//mallocæŒ‡ä»¤å®è´¨
void *           malloc(size_t _Size);
//æŒ‡é’ˆæŒ‡å‘å†…å­˜                  å½“ä½œæ•´æ•°  
```

```c
int main() {

    int number;
    int *a;
    int i;
    printf("Enter number:");
    scanf("%d", &number);//malloc å‡½æ•°è¿”å›ä¸€ä¸ª void* ç±»å‹çš„æŒ‡é’ˆ
    a=(int*)malloc(number*sizeof(int));
    for(i=0;i<number;i++) {
        scanf("%d",&a[i]);
    }

    for(i=number-1;i>=0;i--) {
        printf("%d",a[i]);
    }

    free(a);// é‡Šæ”¾ä¹‹å‰åŠ¨æ€åˆ†é…çš„å†…å­˜
    
    return 0;
}
```

### æ²¡ç©ºé—´äº†ï¼Ÿ

ç”³è¯·å¤±è´¥è¿”å›`NULL(0)`

```c
int main(void) {
    void *p;// å®šä¹‰ä¸€ä¸ªæŒ‡å‘ void ç±»å‹çš„æŒ‡é’ˆå˜é‡ pï¼Œç”¨äºå­˜æ”¾ malloc åˆ†é…çš„å†…å­˜åœ°å€
    int count=0;
    while((p=malloc(100*1024*1024))) {//malloc å‡½æ•°å°è¯•åˆ†é… 100MB çš„å†…å­˜ï¼ˆ100 * 1024 * 1024 å­—èŠ‚ï¼‰
        count++;
    }
    printf("%d\n",count);//Given 58800MB of memory space
    return 0;
}
```

### `free()`

- æŠŠç”³è¯·è¿‡çš„ç©ºé—´è¿˜ç»™â€œç³»ç»Ÿâ€
- åªèƒ½è¿˜ç”³è¯·æ¥çš„ç©ºé—´çš„é¦–åœ°å€

==è‰¯å¥½ä¹ æƒ¯==ï¼šå®šä¹‰æŒ‡é’ˆå°±<u>åˆå§‹ä¸º0</u>

### å¸¸è§é—®é¢˜

- ç”³è¯·äº†æ²¡æœ‰`freeâ†’é•¿æ—¶é—´è¿è¡Œå†…å­˜é€æ¸ä¸‹é™
- `free`è¿‡äº†å†`free`
- åœ°å€å˜è¿‡äº†ï¼Œç›´æ¥å»`free`
